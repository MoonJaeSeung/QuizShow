<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Guess the Word</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<h1>Guess the Word</h1>
<div id="wordContainer">
    <!-- The JavaScript code will generate the forms here -->
</div>

<!-- This is a hidden field for storing the current word's index -->
<input type="hidden" id="currentWordIndex" value="0">
<!-- A div for displaying error messages -->
<div id="errorContainer" style="color: red;"></div>
<script th:inline="javascript">
    /*<![CDATA[*/
    var words = /*[[${words}]]*/ []; // get the words from the Thymeleaf model
    var correctGuesses = 0; // count of correct guesses
    var incorrectGuessesForCurrentWord = 0; // count of incorrect guesses for the current word

    function generateForm() {
        // get the current word index
        var currentWordIndex = parseInt($('#currentWordIndex').val());

        if (currentWordIndex < words.length) {
            // create the HTML for the form
            var word = words[currentWordIndex];
            var revealedPart = word.fullWord.substring(0, 2); // Get the first two letters
            var hiddenPart = word.fullWord.substring(2); // Get the rest of the word

            var formHtml = '<form id="guessForm">' +
                '<label for="guess">' + revealedPart + ' __</label>' +
                '<input type="hidden" id="wordId" value="' + word.id + '">' +
                '<input type="hidden" id="hiddenPart" value="' + hiddenPart + '">' +
                '<input type="text" id="guess" required>' +
                '<button type="submit">Submit Guess</button>' +
                '</form>';

            // set the form HTML in the wordContainer
            $('#wordContainer').html(formHtml);
            $('#errorContainer').html(''); // clear any existing error messages

            // attach the form submit event handler
            $('#guessForm').on('submit', function(event) {
                event.preventDefault(); // prevent the form from being submitted normally

                // get the user's guess
                var guess = $('#guess').val();

                // get the hidden part
                var hiddenPart = $('#hiddenPart').val();

                // check if the guess matches the hidden part
                if (guess.toLowerCase() === hiddenPart.toLowerCase()) {
                    // if the guess is correct, increment the current word index and correctGuesses
                    $('#currentWordIndex').val(currentWordIndex + 1);
                    correctGuesses++;
                    incorrectGuessesForCurrentWord = 0; // reset the count of incorrect guesses
                    generateForm(); // generate the next form
                } else {
                    incorrectGuessesForCurrentWord++;
                    if (incorrectGuessesForCurrentWord >= 2) {
                        // if the user has guessed incorrectly twice, move to the next word
                        $('#errorContainer').html('You have guessed incorrectly twice. Moving to the next word.');
                        $('#currentWordIndex').val(currentWordIndex + 1);
                        incorrectGuessesForCurrentWord = 0; // reset the count of incorrect guesses
                        generateForm(); // generate the next form
                    } else {
                        // if the guess is incorrect, show an error message and clear the input
                        $('#errorContainer').html('Incorrect guess! Please try again.');
                        $('#guess').val('');
                    }
                }
            });
        } else {
            // no more words, display a completion message
            $('#wordContainer').html('<p>You have correctly guessed ' + correctGuesses + ' out of ' + words.length + ' words!</p>');
        }
    }

    // generate the first form when the page loads
    $(document).ready(function() {
        generateForm();
    });
    /*]]>*/
</script>
</body>
</html>